<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Controle Uber Breno</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
 margin:0;
 font-family:'Inter',sans-serif;
 background:radial-gradient(circle at top, #0a0f1f, #050814);
 color:#fff;
}
.login-screen{
 display:flex;align-items:center;justify-content:center;height:100vh;padding:20px;
}
.login-card{
 width:100%;max-width:420px;background:linear-gradient(160deg,#0f1a2e,#0b1324);
 border:1px solid #1e2a44;border-radius:20px;padding:30px 25px;
 box-shadow:0 0 25px rgba(0,0,0,0.7);
}
.logo{text-align:center;font-size:26px;font-weight:600;margin-bottom:8px;}
.subtitle{text-align:center;font-size:13px;color:#9aa7bd;margin-bottom:20px;}
input,select,button{
 width:100%;padding:14px;margin-top:10px;border:none;border-radius:12px;
 background:#132040;color:#fff;font-size:16px;
}
button{background:#2563eb;font-weight:600;cursor:pointer;}
.msg{text-align:center;font-size:13px;color:#ff6b6b;margin-top:8px}
.app-screen{display:none;padding:10px}
h1{text-align:center;font-size:20px;margin:6px 0}
.card{
 background:#0f1a2e;border:1px solid #1e2a44;border-radius:14px;
 padding:14px;margin-bottom:12px;
}
.valor{font-weight:bold;font-size:16px}
.small{font-size:12px;color:#9aa7bd}
button.del{background:#7f1d1d;margin-top:8px}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
 <div class="login-card">
   <div class="logo">ğŸš— Controle Uber</div>
   <div class="subtitle">GestÃ£o Financeira Mobile</div>
   <input value="gbreno17" disabled>
   <input id="senhaLogin" type="password" placeholder="Digite sua senha">
   <button onclick="login()">Entrar</button>
   <div id="loginMsg" class="msg"></div>
 </div>
</div>

<!-- APP -->
<div class="app-screen" id="appScreen">

<h1>ğŸš— Controle Uber</h1>

<div class="card">
 <p class="small">UsuÃ¡rio: gbreno17</p>
 <button onclick="logout()">Sair</button>
</div>

<div class="card">
<h3>ğŸ“¥ Receita</h3>
<input id="rData" type="date">
<input id="rValor" type="number" placeholder="Valor R$">
<input id="rKm" type="number" placeholder="Km rodados">
<button onclick="salvarReceita()">Salvar</button>
</div>

<div class="card">
<h3>â›½ CombustÃ­vel</h3>
<input id="cValor" type="number" placeholder="Valor semanal R$">
<button onclick="salvarCombustivel()">Salvar</button>
</div>

<div class="card">
<h3>ğŸ“¤ Outras Despesas</h3>
<select id="dCatSelect" onchange="verificarCategoria()">
<option value="">Selecionar categoria</option>
<option>Lavagem</option>
<option>ManutenÃ§Ã£o</option>
<option>Internet</option>
<option>Multa</option>
<option>Outros</option>
<option value="personalizada">â• Outra categoria</option>
</select>
<input id="dCatPersonalizada" placeholder="Digite categoria..." style="display:none">
<input id="dValor" type="number" placeholder="Valor R$">
<input id="dData" type="date">
<button onclick="salvarDespesa()">Salvar</button>
</div>

<div class="card">
<h3>ğŸ“Š Cofrinho Semanal</h3>
<input id="semanaRef" type="date">
<button onclick="gerarRelatorioSemanal()">Gerar</button>
<div id="relatorioSemanal"></div>
</div>

<div class="card">
<h3>ğŸ“† Lucro Mensal</h3>
<input id="mesRef" type="month">
<button onclick="gerarRelatorioMensal()">Gerar</button>
<div id="relatorioMensal"></div>
</div>

<div class="card">
<h3>ğŸ“‹ Receitas Salvas</h3>
<div id="listaReceitas"></div>
</div>

<div class="card">
<h3>ğŸ“‹ Despesas Salvas</h3>
<div id="listaDespesas"></div>
</div>

</div>

<script>
// LOGIN
const SENHA_FIXA="1290";
function login(){
 if(senhaLogin.value===SENHA_FIXA){
   loginScreen.style.display="none";
   appScreen.style.display="block";
   iniciarApp();
 } else loginMsg.innerText="Senha incorreta";
}
function logout(){
 appScreen.style.display="none";
 loginScreen.style.display="flex";
 senhaLogin.value="";
}

// FIREBASE
const firebaseConfig={
 apiKey:"AIzaSyA-_H0sBY59QpuLX28hCh0ShPXseKA5Khc",
 authDomain:"controle-uber-breno.firebaseapp.com",
 projectId:"controle-uber-breno"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

// CONFIG
const percPneu=1.5;
const percSeguro=5;
const percMotorista=7;
const custoKmTotal=0.93;
const parcelaCarroMensal=1090;

function hojeISO(){return new Date().toISOString().slice(0,10);}
function num(v){return Number(v||0);}
function brl(v){return num(v).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});}

function iniciarApp(){
 rData.value=hojeISO();
 dData.value=hojeISO();
 semanaRef.value=hojeISO();
 carregarReceitas();
 carregarDespesas();
}

function verificarCategoria(){
 dCatPersonalizada.style.display = dCatSelect.value==="personalizada" ? "block" : "none";
}

async function salvarReceita(){
 await db.collection("receitas").add({data:rData.value,valor:num(rValor.value),km:num(rKm.value)});
 alert("Receita salva!");
 rValor.value=""; rKm.value="";
 carregarReceitas();
}

async function salvarCombustivel(){
 await db.collection("combustivel").add({data:semanaRef.value,valor:num(cValor.value)});
 alert("CombustÃ­vel salvo!");
 cValor.value="";
}

async function salvarDespesa(){
 let categoria=dCatSelect.value;
 if(categoria==="personalizada"){categoria=dCatPersonalizada.value || "Outros";}
 await db.collection("despesas").add({data:dData.value,valor:num(dValor.value),categoria});
 alert("Despesa salva!");
 dValor.value="";
 carregarDespesas();
}

// LISTAGENS
async function carregarReceitas(){
 const snap = await db.collection("receitas").orderBy("data","asc").get();
 let html="";
 snap.docs.forEach(doc=>{
   const x=doc.data();
   html+=`<div class="card">
      <p>${x.data} â€” <b>${brl(x.valor)}</b> | Km: ${x.km||0}</p>
      <button class="del" onclick="excluirReceita('${doc.id}')">âŒ Excluir</button>
    </div>`;
 });
 listaReceitas.innerHTML = html || "<p class='small'>Nenhuma receita</p>";
}

async function carregarDespesas(){
 const snap = await db.collection("despesas").orderBy("data","asc").get();
 let html="";
 snap.docs.forEach(doc=>{
   const x=doc.data();
   html+=`<div class="card">
      <p>${x.data} â€” ${x.categoria} â€” <b>${brl(x.valor)}</b></p>
      <button class="del" onclick="excluirDespesa('${doc.id}')">âŒ Excluir</button>
    </div>`;
 });
 listaDespesas.innerHTML = html || "<p class='small'>Nenhuma despesa</p>";
}

async function excluirReceita(id){
 if(confirm("Excluir esta receita?")){
   await db.collection("receitas").doc(id).delete();
   carregarReceitas();
 }
}

async function excluirDespesa(id){
 if(confirm("Excluir esta despesa?")){
   await db.collection("despesas").doc(id).delete();
   carregarDespesas();
 }
}

// ğŸ”¹ RELATÃ“RIO SEMANAL (AGORA COM DESPESAS)
async function gerarRelatorioSemanal(){
 const dataBase=new Date(semanaRef.value);
 const diaSemana=dataBase.getDay();
 const diffSegunda=dataBase.getDate()-diaSemana+(diaSemana==0?-6:1);
 const segunda=new Date(dataBase.setDate(diffSegunda));
 const domingo=new Date(segunda);domingo.setDate(segunda.getDate()+6);
 const inicio=segunda.toISOString().slice(0,10);
 const fim=domingo.toISOString().slice(0,10);

 const recSnap=await db.collection("receitas").get();
 const combSnap=await db.collection("combustivel").get();
 const despSnap=await db.collection("despesas").get();

 let totalBruto=0,totalComb=0,totalDesp=0;

 recSnap.docs.forEach(d=>{
   const x=d.data();
   if(x.data>=inicio && x.data<=fim){ totalBruto+=num(x.valor); }
 });

 combSnap.docs.forEach(d=>{
   const x=d.data();
   if(x.data>=inicio && x.data<=fim){ totalComb+=num(x.valor); }
 });

 despSnap.docs.forEach(d=>{
   const x=d.data();
   if(x.data>=inicio && x.data<=fim){ totalDesp+=num(x.valor); }
 });

 const reservaPneu=(percPneu/100)*totalBruto;
 const reservaSeguro=(percSeguro/100)*totalBruto;
 const pagamentoMotorista=(percMotorista/100)*totalBruto;

 const parcelaCarro = totalBruto - 
 (reservaPneu + reservaSeguro + pagamentoMotorista + totalComb + totalDesp);

 relatorioSemanal.innerHTML=`
 <p>Bruto: <b>${brl(totalBruto)}</b></p>
 <p>CombustÃ­vel: ${brl(totalComb)}</p>
 <p>Outras despesas: ${brl(totalDesp)}</p>
 <p>Pneus: ${brl(reservaPneu)}</p>
 <p>Seguro: ${brl(reservaSeguro)}</p>
 <p>Motorista: ${brl(pagamentoMotorista)}</p>
 <hr>
 <p class="valor">Parcela carro: ${brl(parcelaCarro)}</p>`;
}

// ğŸ”¹ RELATÃ“RIO MENSAL (AGORA COM DESPESAS)
async function gerarRelatorioMensal(){
 const mes=mesRef.value;

 const recSnap=await db.collection("receitas").get();
 const despSnap=await db.collection("despesas").get();

 let totalBruto=0,totalKm=0,totalDesp=0;

 recSnap.docs.forEach(d=>{
  const x=d.data();
  if(x.data.startsWith(mes)){
    totalBruto+=num(x.valor);
    totalKm+=num(x.km);
  }
 });

 despSnap.docs.forEach(d=>{
  const x=d.data();
  if(x.data.startsWith(mes)){
    totalDesp+=num(x.valor);
  }
 });

 const custoRodagem = totalKm * custoKmTotal;
 const lucroReal = totalBruto - custoRodagem - parcelaCarroMensal - totalDesp;

 relatorioMensal.innerHTML=`
 <p>Bruto: <b>${brl(totalBruto)}</b></p>
 <p>Custo km: ${brl(custoRodagem)}</p>
 <p>Parcela carro: ${brl(parcelaCarroMensal)}</p>
 <p>Outras despesas: ${brl(totalDesp)}</p>
 <hr>
 <p class="valor">Lucro real: ${brl(lucroReal)}</p>`;
}
</script>
</body>
</html>
